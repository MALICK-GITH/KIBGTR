services:
  # Service Web Principal - ORACXPRED MÃ‰TAPHORE
  - type: web
    name: oracxpred-metaphore
    runtime: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: python app_render_fixed.py
    healthCheckPath: /api/health
    
    # Variables d'environnement de base
    envVars:
      - key: PYTHON_VERSION
        value: 3.12
      - key: FLASK_ENV
        value: production
      - key: FLASK_DEBUG
        value: false
      - key: PORT
        value: 10000
    
    # Configuration pour le scaling
    autoDeploy: true
    
    # Domaine Render automatique
    domains:
      - oracxpred-metaphore.onrender.com

  # Base de donnÃ©es PostgreSQL persistante
  - type: pserv
    name: oracxpred-db
    databaseName: oracxpred
    plan: free
    ipAllowList: []
    
    # Configuration PostgreSQL optimisÃ©e
    postgresVersion: 14
    
    # Sauvegardes automatiques Render
    backup:
      # Backup quotidien Ã  2h du matin UTC
      schedule: "0 2 * * *"
      # Conservation 30 jours
      retentionDays: 30
    
    # Variables de connexion sÃ©curisÃ©es
    envVars:
      - key: POSTGRES_USER
        value: oracxpred_user
      - key: POSTGRES_PASSWORD
        generateValue: true
      - key: POSTGRES_DB
        value: oracxpred

  # Service de backup automatique supplÃ©mentaire
  - type: cron
    name: oracxpred-backup-service
    schedule: "0 3 * * *"  # Tous les jours Ã  3h UTC
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python render_backup_service.py
    
    envVars:
      - key: BACKUP_TYPE
        value: daily_full
      - key: RETENTION_DAYS
        value: 30
      - key: BACKUP_LOCATION
        value: render_internal

# Configuration globale du build
version: "1"
build:
  commands:
    - echo "ðŸš€ Build ORACXPRED MÃ‰TAPHORE pour Render"
    - python -m pip install --upgrade pip
    - pip install -r requirements.txt
    - echo "âœ… Build terminÃ© - SignÃ© SOLITAIRE HACK ðŸ‡¨ðŸ‡®"

# DÃ©pendances entre services
dependencies:
  - oracxpred-db
